<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Eventos disponibles</title>
    <style>
        :root {
            --color-primary: #007bff;
            --color-primary-hover: #0056b3;
            --color-secondary: #6c757d;
            --color-secondary-hover: #545b62;
            --color-success: #28a745;
            --color-success-hover: #218838;
            --color-success-light: #d4edda;
            --color-success-dark: #155724;
            --color-danger: #dc3545;
            --color-danger-light: #f8d7da;
            --color-danger-dark: #721c24;
            --color-background: #f6f6f6;
            --color-surface: #fff;
            --color-header-bg: #222;
            --color-light-gray: #eee;
            --color-dark-gray: #333;
            --color-disabled: #ccc;
            --color-text-primary: #333;
            --color-text-secondary: #666;
            --color-white: #fff;
            --color-backdrop: rgba(0, 0, 0, 0.8);
            --color-overlay: rgba(0, 0, 0, 0.5);
            --color-gallery-overlay: rgba(255, 255, 255, 0.1);
            --color-gallery-overlay-hover: rgba(255, 255, 255, 0.2);
            --color-spinner-track: #f3f3f3;
        }

        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background: var(--color-background);
        }

        header {
            background: var(--color-header-bg);
            color: var(--color-white);
            padding: 10px;
            text-align: center;
        }

        .carousel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 16px;
            margin: 20px;
            padding: 0;
        }

        .carousel-item {
            max-height: 297px;
            position: relative;
            width: 260px;
            background: var(--color-surface);
            border-radius: 10px;
            cursor: pointer;
            transition: box-shadow 0.2s;
            flex-shrink: 0;
        }

        .carousel-item:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .carousel-item .foto {
            position: relative;
            width: 100%;
            height: 156px;
            overflow: hidden;
            border-radius: 10px 10px 0 0;
        }

        .carousel-item .foto img {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }

        @media only screen and (max-width: 759px) {
            .carousel-item .foto {
                height: 9.75rem;
            }
        }

        .card-eventos {
            background: var(--color-surface) !important;
            max-width: 260px !important;
            padding: 1rem !important;
            width: 100% !important;
            text-align: left;
            border-radius: 0 0 10px 10px;
        }

        .card-titulo-evento {
            font-weight: bold;
            margin-bottom: 0.5rem;
            font-size: 1.1em;
        }

        .card-data-evento,
        .card-cid-evento {
            margin-bottom: 0.25rem;
            font-size: 0.9em;
            color: var(--color-text-secondary);
        }

        .icon-eve-home {
            width: 16px;
            height: 16px;
            margin-right: 0.5rem;
            vertical-align: middle;
        }

        .nome-cidade-card {
            font-weight: 500;
        }

        .gallery {
            display: flex;
            flex-wrap: wrap;
            margin: 20px;
        }

        .gallery-item {
            position: relative;
            margin: 8px;
            background: var(--color-light-gray);
            border-radius: 4px;
            cursor: pointer;
            transition: border 0.2s, box-shadow 0.2s;
        }

        .gallery-item.selected {
            border: 3px solid var(--color-primary);
        }

        .gallery-item:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .gallery img {
            height: 200px;
            width: auto;
            display: block;
            object-fit: contain;
            border-radius: 4px;
        }

        .gallery-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--color-overlay);
            display: none;
            flex-direction: column;
            border-radius: 4px;
        }

        .gallery-item:hover .gallery-overlay {
            display: flex;
        }

        .gallery-overlay-top,
        .gallery-overlay-bottom {
            flex: 1;
            width: 100%;
            background: var(--color-gallery-overlay);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-white);
            font-weight: bold;
            font-size: 16px;
            border: none;
            cursor: pointer;
            transition: background 0.2s;
            margin: 0px;
            padding: 0px;
            border-radius: 0px;
        }

        .gallery-overlay-top {
            border-bottom: 1px solid var(--color-white);
        }

        .gallery-overlay-top:hover,
        .gallery-overlay-bottom:hover {
            background: var(--color-gallery-overlay-hover);
        }

        button {
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            background: var(--color-primary);
            color: var(--color-white);
        }

        button:hover {
            background: var(--color-primary-hover);
        }

        .selection-controls {
            margin: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .selected-count {
            font-weight: bold;
            color: var(--color-text-primary);
        }

        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--color-backdrop);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 8px;
        }

        .lightbox-nav,
        .review-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: var(--color-dark-gray);
            color: var(--color-white);
            border: none;
            font-size: 28px;
            font-weight: bold;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 50%;
            z-index: 1003;
        }

        .lightbox-prev,
        .review-prev {
            left: 20px;
        }

        .lightbox-next,
        .review-next {
            right: 20px;
        }

        .lightbox-select {
            position: absolute;
            bottom: 20px;
            right: 20px;
            padding: 8px 12px;
            border-radius: 5px;
            color: var(--color-white);
            cursor: pointer;
            border: none;
            z-index: 1003;
        }

        .lightbox-select.select {
            background: var(--color-primary);
        }

        .lightbox-select.deselect {
            background: var(--color-danger);
        }

        .lightbox-select:hover {
            opacity: 0.8;
        }
        
        .lightbox-generate {
            position: absolute;
            bottom: 20px;
            left: 20px;
            padding: 8px 12px;
            border-radius: 5px;
            background: var(--color-success);
            color: var(--color-white);
            border: none;
            cursor: pointer;
            z-index: 1003;
        }

        .lightbox-generate:hover {
            background: var(--color-success-hover);
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--color-overlay);
            color: var(--color-white);
            border: none;
            font-size: 24px;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 50%;
            z-index: 1001;
        }

        .lightbox-backdrop {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .lightbox-image-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 90%;
            max-height: 90%;
        }

        .review-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--color-backdrop);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .review-content {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 8px;
            max-width: 90%;
            max-height: 80vh;
            width: 600px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .review-scrollable {
            flex-grow: 1;
            overflow-y: auto;
            width: 100%;
            text-align: center;
        }

        .review-header {
            text-align: center;
            margin-bottom: 10px;
            width: 100%;
        }

        .review-image {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .review-nav {
            z-index: 2;
            font-size: 24px;
            padding: 8px 12px;
        }

        .review-prev {
            left: 10px;
        }

        .review-next {
            right: 10px;
        }

        .review-footer {
            padding-top: 15px;
            width: 100%;
            border-top: 1px solid var(--color-light-gray);
        }

        .review-deselect {
            background: var(--color-danger);
            width: 100%;
            padding: 8px 12px;
            border-radius: 5px;
            color: var(--color-white);
            border: none;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .review-buttons {
            display: flex;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }

        .review-buttons button {
            flex: 1;
            margin: 0;
        }

        .review-image-container {
            position: relative;
            width: 100%;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px;
            width: calc(100% - 40px);
        }

        .back-button {
            background: var(--color-secondary);
        }

        .back-button:hover {
            background: var(--color-secondary-hover);
        }

        .selection-controls-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .email-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--color-backdrop);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1002;
        }

        .email-content {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 8px;
            max-width: 90%;
            max-height: 80%;
            width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .email-header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }

        .email-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--color-disabled);
            border-radius: 4px;
            font-size: 16px;
        }

        .email-buttons {
            display: flex;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }

        .email-buttons button {
            flex: 1;
            margin: 0;
        }

        .email-buttons .cancel {
            background: var(--color-secondary);
        }

        .email-buttons .cancel:hover {
            background: var(--color-secondary-hover);
        }

        .email-buttons .submit {
            background: var(--color-success);
        }

        .email-buttons .submit:hover {
            background: var(--color-success-hover);
        }

        .email-buttons .submit:disabled {
            background: var(--color-disabled);
            cursor: not-allowed;
        }

        .loading-spinner {
            border: 4px solid var(--color-spinner-track);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--color-overlay);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            z-index: 1;
        }

        .lightbox img,
        .review-image {
            z-index: 2;
        }

        .events-header {
            padding: 40px;
            text-align: center;
        }

        .result-modal-success {
            background: var(--color-success-light) !important;
            border-left: 4px solid var(--color-success);
        }

        .result-modal-error {
            background: var(--color-danger-light) !important;
            border-left: 4px solid var(--color-danger);
        }

        .result-modal-success .email-header h2,
        .result-modal-success .email-header p {
            color: var(--color-success-dark);
        }

        .result-modal-error .email-header h2,
        .result-modal-error .email-header p {
            color: var(--color-danger-dark);
        }
        
        @media (max-width: 600px) {
            .review-content {
                height: 80vh;
            }

            .events-header {
                padding: 20px;
            }

            .carousel-item {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script type="text/babel">
        let React = React; // Para compatibilidad con Babel Standalone @6
        emailjs.init("trRTddWLTqdGsxznW");

        function Lightbox(props) {
            let photos = props.photos;
            let index = props.index;
            let onClose = props.onClose;
            let onPrev = props.onPrev;
            let onNext = props.onNext;
            let onToggleSelect = props.onToggleSelect;
            let onGenerateOrder = props.onGenerateOrder;
            let selectedPhotos = props.selectedPhotos;

            let [isImageLoading, setIsImageLoading] = React.useState(true);
            let [touchStart, setTouchStart] = React.useState(null);
            let [touchEnd, setTouchEnd] = React.useState(null);

            if (index === -1) return null;
            let photo = photos[index];
            let isSelected = false;
            if (photo && selectedPhotos.length > 0) {
                for (let i = 0; i < selectedPhotos.length; i++) {
                    if (selectedPhotos[i].id === photo.id) {
                        isSelected = true;
                        break;
                    }
                }
            }
            let selectClass = isSelected ? 'lightbox-select deselect' : 'lightbox-select select';
            let handleImageLoad = function () {
                setIsImageLoading(false);
            };
            let resetLoading = function () {
                setIsImageLoading(true);
            };

            let handleTouchStart = function (e) {
                setTouchEnd(null);
                setTouchStart(e.targetTouches[0].clientX);
            };

            let handleTouchMove = function (e) {
                setTouchEnd(e.targetTouches[0].clientX);
            };

            let handleTouchEnd = function () {
                if (!touchStart || !touchEnd) return;
                let distance = touchStart - touchEnd;
                let isLeftSwipe = distance > 50;
                let isRightSwipe = distance < -50;
                if (isLeftSwipe) {
                    resetLoading();
                    onNext();
                }
                if (isRightSwipe) {
                    resetLoading();
                    onPrev();
                }
                setTouchStart(null);
                setTouchEnd(null);
            };

            let elements = [
                React.createElement('div', {
                    className: 'lightbox',
                    onClick: onClose,
                    onTouchStart: handleTouchStart,
                    onTouchMove: handleTouchMove,
                    onTouchEnd: handleTouchEnd,
                    key: 'lightbox-container'
                },
                    React.createElement('div', { className: 'lightbox-backdrop', onClick: onClose, key: 'backdrop' }),
                    React.createElement('button', { className: 'lightbox-close', onClick: function (e) { e.stopPropagation(); onClose(); }, key: 'close' }, '√ó'),
                    React.createElement('button', { className: 'lightbox-nav lightbox-prev', onClick: function (e) { e.stopPropagation(); resetLoading(); onPrev(); }, key: 'prev' }, '‚Üê'),
                    React.createElement('div', { className: 'lightbox-image-container', onClick: function (e) { e.stopPropagation(); }, key: 'image-container' },
                        isImageLoading && React.createElement('div', { className: 'loading-overlay', key: 'loading' },
                            React.createElement('div', { className: 'loading-spinner' })
                        ),
                        React.createElement('img', {
                            src: photo.url,
                            alt: photo.name,
                            onClick: function (e) { e.stopPropagation(); },
                            onLoad: handleImageLoad,
                            style: { display: isImageLoading ? 'none' : 'block' },
                            key: 'image'
                        })
                    ),
                    React.createElement('button', { className: 'lightbox-nav lightbox-next', onClick: function (e) { e.stopPropagation(); resetLoading(); onNext(); }, key: 'next' }, '‚Üí'),
                    React.createElement('button', { className: selectClass, onClick: function (e) { e.stopPropagation(); onToggleSelect(photo); }, key: 'select' },
                        isSelected ? 'Deseleccionar' : 'Seleccionar'
                    ),
                    selectedPhotos.length > 0 && React.createElement('button', {
                        className: 'lightbox-generate',
                        onClick: function (e) { e.stopPropagation(); onGenerateOrder(); },
                        key: 'generate'
                    }, 'Ir a orden')
                )
            ];

            if (selectedPhotos.length > 0) {
                elements.push(
                    React.createElement('button', {
                        className: 'lightbox-generate',
                        onClick: function (e) { e.stopPropagation(); onGenerateOrder(); },
                        key: 'generate'
                    }, 'Generar orden')
                );
            }

            return React.createElement('div', null, elements);
        }

        function ReviewModal(props) {
    let selectedPhotos = props.selectedPhotos;
    let reviewIndex = props.reviewIndex;
    let onClose = props.onClose;
    let onDeselect = props.onDeselect;
    let onPrev = props.onPrev;
    let onNext = props.onNext;
    let onConfirm = props.onConfirm;

    let [isImageLoading, setIsImageLoading] = React.useState(true);
    let [touchStart, setTouchStart] = React.useState(null);
    let [touchEnd, setTouchEnd] = React.useState(null);

    if (!selectedPhotos || selectedPhotos.length === 0) return null;
    let photo = selectedPhotos[reviewIndex];
    if (!photo) return null;

    let handleImageLoad = function () { setIsImageLoading(false); };
    let resetLoading = function () { setIsImageLoading(true); };

    let handleTouchStart = function (e) {
        setTouchEnd(null);
        setTouchStart(e.targetTouches[0].clientX);
    };
    let handleTouchMove = function (e) {
        setTouchEnd(e.targetTouches[0].clientX);
    };
    let handleTouchEnd = function () {
        if (!touchStart || !touchEnd) return;
        let distance = touchStart - touchEnd;
        if (distance > 50) { resetLoading(); onNext(); }
        if (distance < -50) { resetLoading(); onPrev(); }
        setTouchStart(null);
        setTouchEnd(null);
    };

    // Crea los nav solo si hay m√°s de una foto
    let navButtons = null;
    if (selectedPhotos.length > 1) {
        navButtons = [
            React.createElement('button', { 
                className: 'review-nav review-prev', 
                onClick: function (e) { e.stopPropagation(); resetLoading(); onPrev(); }, 
                key: 'prev-nav' 
            }, '‚Üê'),
            React.createElement('button', { 
                className: 'review-nav review-next', 
                onClick: function (e) { e.stopPropagation(); resetLoading(); onNext(); }, 
                key: 'next-nav' 
            }, '‚Üí')
        ];
    }

    return React.createElement('div', {
        className: 'review-modal',
        onClick: onClose,
        onTouchStart: handleTouchStart,
        onTouchMove: handleTouchMove,
        onTouchEnd: handleTouchEnd
    },
        React.createElement('div', { className: 'review-content', onClick: function (e) { e.stopPropagation(); } },
            React.createElement('div', { className: 'review-scrollable' },
                React.createElement('div', { className: 'review-header' },
                    React.createElement('h2', null, 'Confirma tu selecci√≥n de im√°genes'),
                    React.createElement('h2', null, selectedPhotos.length === 1 ? `${selectedPhotos.length} imagen seleccionada` : `${selectedPhotos.length} im√°genes seleccionadas`)
                ),
                React.createElement('div', { className: 'review-image-container', onClick: function (e) { e.stopPropagation(); } },
                    isImageLoading ? React.createElement('div', { className: 'loading-overlay' },
                        React.createElement('div', { className: 'loading-spinner' })
                    ) : null,
                    React.createElement('img', {
                        src: photo.url,
                        alt: photo.name,
                        className: 'review-image',
                        onClick: function (e) { e.stopPropagation(); },
                        onLoad: handleImageLoad,
                        style: { display: isImageLoading ? 'none' : 'block' }
                    })
                )
            ),
            React.createElement('div', { className: 'review-footer' },
                React.createElement('button', { className: 'review-deselect', onClick: function (e) { e.stopPropagation(); onDeselect(photo, true); } }, 'Deseleccionar'),
                React.createElement('div', { className: 'review-buttons' },
                    React.createElement('button', { onClick: onClose }, 'Volver'),
                    React.createElement('button', { onClick: onConfirm }, 'Confirmar')
                )
            )
        ),
        // Inserta los nav como hijos del mismo overlay
        navButtons
    );
}

        function EmailModal(props) {
            let email = props.email;
            let setEmail = props.setEmail;
            let onClose = props.onClose;
            let onSubmit = props.onSubmit;
            let selectedPhotos = props.selectedPhotos;
            let isSendingEmail = props.isSendingEmail;

            let handleChange = function (e) {
                setEmail(e.target.value);
            };

            let isValidEmail = function (emailStr) {
                return emailStr && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailStr);
            };

            let submitDisabled = !isValidEmail(email) || isSendingEmail;

            let inputElement = React.createElement('input', {
                type: 'email',
                className: 'email-input',
                placeholder: 'tu@email.com',
                value: email,
                onChange: handleChange,
                disabled: isSendingEmail
            });

            let cancelButton = React.createElement('button', { 
                className: 'cancel', 
                onClick: onClose,
                disabled: isSendingEmail 
            }, 'Cancelar');

            let submitButton = React.createElement('button', {
                className: 'submit',
                onClick: function () { if (!submitDisabled) onSubmit(email, selectedPhotos); },
                disabled: submitDisabled
            }, isSendingEmail ? 'Enviando...' : 'Enviar orden');

            let buttonsDiv = React.createElement('div', { className: 'email-buttons' }, cancelButton, submitButton);

            let loadingOverlay = isSendingEmail ? React.createElement('div', { className: 'loading-overlay' },
                React.createElement('div', { className: 'loading-spinner' })
            ) : null;

            return React.createElement('div', { className: 'email-modal', onClick: isSendingEmail ? null : onClose },
                React.createElement('div', { className: 'email-content', onClick: function (e) { e.stopPropagation(); } },
                    React.createElement('div', { className: 'email-header' },
                        React.createElement('h2', null, 'Ingresa tu email para la orden'),
                        React.createElement('p', null, 'Te contactaremos cuando la orden sea recibida por el equipo.')
                    ),
                    inputElement,
                    buttonsDiv,
                    loadingOverlay
                )
            );
        }

        function ResultModal(props) {
            let resultMessage = props.resultMessage;
            let onClose = props.onClose;

            let isSuccess = resultMessage.type === 'success';
            let modalClass = 'email-modal';
            let contentClass = isSuccess ? 'email-content result-modal-success' : 'email-content result-modal-error';

            let acceptButton = React.createElement('button', { 
                onClick: onClose,
                style: { background: isSuccess ? '#28a745' : '#dc3545' }
            }, 'Aceptar');

            return React.createElement('div', { className: modalClass, onClick: onClose },
                React.createElement('div', { className: contentClass, onClick: function (e) { e.stopPropagation(); } },
                    React.createElement('div', { className: 'email-header' },
                        React.createElement('h2', null, resultMessage.title),
                        React.createElement('p', null, resultMessage.message)
                    ),
                    React.createElement('div', { className: 'email-buttons' }, acceptButton)
                )
            );
        }

        function Gallery(props) {
            let photos = props.photos;
            let isSelectionMode = props.isSelectionMode;
            let hasSelections = props.hasSelections;
            let selectedPhotos = props.selectedPhotos;
            let onToggleSelect = props.onToggleSelect;
            let onOpenLightbox = props.onOpenLightbox;

            if (!photos || photos.length === 0) {
                return React.createElement('p', null, 'No hay fotos para mostrar.');
            }
            let items = [];
            for (let j = 0; j < photos.length; j++) {
                let photo = photos[j];
                let idx = j;
                let isSelected = false;
                for (let k = 0; k < selectedPhotos.length; k++) {
                    if (selectedPhotos[k].id === photo.id) {
                        isSelected = true;
                        break;
                    }
                }
                let className = 'gallery-item' + (isSelectionMode && isSelected ? ' selected' : '');
                let onClick = function (isSelectionMode, photo, idx) {
                    return function () {
                        if (isSelectionMode) {
                            onToggleSelect(photo);
                        } else {
                            onOpenLightbox(idx);
                        }
                    };
                }(isSelectionMode, photo, idx);
                let overlay = null;
                if (hasSelections) {
                    let topOnClick = function (idx) { return function (e) { e.stopPropagation(); onOpenLightbox(idx); }; }(idx);
                    let bottomOnClick = function (photo) { return function (e) { e.stopPropagation(); onToggleSelect(photo); }; }(photo);
                    let bottomText = isSelected ? 'Deseleccionar' : 'Seleccionar';
                    overlay = React.createElement('div', { className: 'gallery-overlay' },
                        React.createElement('button', { className: 'gallery-overlay-top', onClick: topOnClick }, 'Ver'),
                        React.createElement('button', { className: 'gallery-overlay-bottom', onClick: bottomOnClick }, bottomText)
                    );
                }
                items.push(
                    React.createElement('div', { key: `${photo.name}-${j}`, className: className, onClick: onClick },
                        React.createElement('img', { src: photo.url, alt: photo.name || 'Imagen' }),
                        overlay
                    )
                );
            }
            return React.createElement('div', { className: 'gallery' }, items);
        }

        function App() {
            let [events, setEvents] = React.useState([]);
            let [selectedEvent, setSelectedEvent] = React.useState(null);
            let [selectedPhotos, setSelectedPhotos] = React.useState([]);
            let [isSelectionMode, setIsSelectionMode] = React.useState(false);
            let [lightboxIndex, setLightboxIndex] = React.useState(-1);
            let [showReview, setShowReview] = React.useState(false);
            let [reviewIndex, setReviewIndex] = React.useState(0);
            let [showEmailModal, setShowEmailModal] = React.useState(false);
            let [email, setEmail] = React.useState('');
            let [showResultModal, setShowResultModal] = React.useState(false);
            let [resultMessage, setResultMessage] = React.useState({ type: 'success', title: '', message: '' });
            let [emailsConfig, setEmailsConfig] = React.useState({ adminEmail: '', ccEmails: [] });
            let [isSendingEmail, setIsSendingEmail] = React.useState(false);

            let hasSelections = selectedPhotos.length > 0;

            let lockBody = function () {
                let scrollY = window.scrollY;
                document.body.style.position = 'fixed';
                document.body.style.top = `-${scrollY}px`;
                document.body.style.width = '100%';
            };

            let unlockBody = function () {
                let scrollY = document.body.style.top;
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.width = '';
                window.scrollTo(0, parseInt(scrollY || '0') * -1);
            };

            let isAnyModalOpen = lightboxIndex !== -1 || showReview || showEmailModal || showResultModal;

            React.useEffect(function () {
                if (isAnyModalOpen) {
                    lockBody();
                } else {
                    unlockBody();
                }
            }, [lightboxIndex, showReview, showEmailModal, showResultModal]);

            let toggleSelectionMode = function () {
                setIsSelectionMode(!isSelectionMode);
                if (!isSelectionMode) {
                    setSelectedPhotos([]);
                    setLightboxIndex(-1);
                }
            };

            let toggleSelect = function (photo) {
                let prevLength = selectedPhotos.length;
                let newSelected = [];
                let alreadySelected = false;
                for (let l = 0; l < selectedPhotos.length; l++) {
                    if (selectedPhotos[l].id !== photo.id) {
                        newSelected.push(selectedPhotos[l]);
                    } else {
                        alreadySelected = true;
                    }
                }
                if (!alreadySelected) {
                    newSelected.push(photo);
                }
                setSelectedPhotos(newSelected);
                if (prevLength === 0 && newSelected.length > 0 && !isSelectionMode) {
                    setIsSelectionMode(true);
                }
                if (newSelected.length === 0) {
                    setIsSelectionMode(false);
                }
            };

            let removeSelect = function (photo, resetIndex) {
                let newSelected = [];
                for (let m = 0; m < selectedPhotos.length; m++) {
                    if (selectedPhotos[m].id !== photo.id) {
                        newSelected.push(selectedPhotos[m]);
                    }
                }
                setSelectedPhotos(newSelected);
                if (newSelected.length === 0) {
                    setIsSelectionMode(false);
                }
                if (resetIndex && showReview) {
                    if (newSelected.length === 0) {
                        setShowReview(false);
                    } else {
                        setReviewIndex(0);
                    }
                }
            };

            let handleConfirm = function () {
                setShowReview(false);
                setShowEmailModal(true);
            };

            let handleEmailSubmit = function (userEmail, selectedPhotosParam) {
                setIsSendingEmail(true);

                let params = {
                    to_email: emailsConfig.adminEmail,
                    cc_emails: emailsConfig.ccEmails.join(','),
                    user_email: userEmail,
                    nombreEvento: selectedEvent ? selectedEvent.name : 'Evento no especificado',
                    photos: selectedPhotosParam.map(p => p.name.substring(0, p.name.lastIndexOf('.'))).join('\n')
                };

                emailjs.send("service_fotosEventos", "template_0ntzv59", params)
                    .then((result) => {
                        console.log('Email enviado exitosamente!', result.text);
                        setIsSendingEmail(false);
                        setResultMessage({
                            type: 'success',
                            title: '¬°Orden enviada!',
                            message: 'Te contactaremos pronto con los detalles de tu orden.'
                        });
                        setShowResultModal(true);
                        setShowEmailModal(false);
                    }, (error) => {
                        console.log('Error al enviar email:', error.text);
                        setIsSendingEmail(false);
                        setResultMessage({
                            type: 'error',
                            title: 'Error al enviar',
                            message: 'No pudimos procesar tu orden. Por favor, intenta de nuevo.'
                        });
                        setShowResultModal(true);
                    });
            };

            let handleGenerateFromLightbox = function () {
                setLightboxIndex(-1);
                setShowReview(true);
                setReviewIndex(0);
            };

            let handleSelectEvent = function (ev) {
                setSelectedEvent(ev);
                setSelectedPhotos([]);
                setIsSelectionMode(false);
                setLightboxIndex(-1);
                setShowReview(false);
                setShowEmailModal(false);
                setEmail('');
                setReviewIndex(0);
            };

            let openLightbox = function (idx) {
                setLightboxIndex(idx);
            };

            let closeLightbox = function () {
                setLightboxIndex(-1);
            };

            let getPhotoLength = function () {
                if (selectedEvent && selectedEvent.photos) {
                    return selectedEvent.photos.length;
                }
                return 0;
            };

            let photoLength = getPhotoLength();

            let prevPhoto = function () {
                let newIndex = lightboxIndex - 1;
                if (newIndex < 0) {
                    newIndex = photoLength - 1;
                }
                setLightboxIndex(newIndex);
            };

            let nextPhoto = function () {
                let newIndex = lightboxIndex + 1;
                if (newIndex >= photoLength) {
                    newIndex = 0;
                }
                setLightboxIndex(newIndex);
            };

            let prevReview = function () {
                let newIndex = reviewIndex - 1;
                if (newIndex < 0) {
                    newIndex = selectedPhotos.length - 1;
                }
                setReviewIndex(newIndex);
            };

            let nextReview = function () {
                let newIndex = reviewIndex + 1;
                if (newIndex >= selectedPhotos.length) {
                    newIndex = 0;
                }
                setReviewIndex(newIndex);
            };

            let handleKeyDown = function (e) {
                if (lightboxIndex === -1) return;
                if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    prevPhoto();
                } else if (e.key === 'ArrowRight') {
                    e.preventDefault();
                    nextPhoto();
                }
            };

            React.useEffect(function () {
                if (lightboxIndex !== -1) {
                    window.addEventListener('keydown', handleKeyDown);
                    return function () {
                        window.removeEventListener('keydown', handleKeyDown);
                    };
                }
            }, [lightboxIndex]);

            React.useEffect(function () {
                fetch('events.json')
                    .then(function (response) { return response.json(); })
                    .then(function (data) { setEvents(data); })
                    .catch(function () { setEvents([]); });
            }, []);

            React.useEffect(function () {
                fetch('emails.json')
                    .then(function (response) { return response.json(); })
                    .then(function (data) { setEmailsConfig(data); })
                    .catch(function () { setEmailsConfig({ adminEmail: '', ccEmails: [] }); });
            }, []);

            React.useEffect(function () {
                if (selectedEvent) {
                    document.title = selectedEvent.name;
                } else {
                    document.title = 'Eventos disponibles';
                }
            }, [selectedEvent]);

            let photos = [];
            if (selectedEvent && selectedEvent.photos) {
                photos = selectedEvent.photos;
            }

            let carouselItems = [];
            for (let n = 0; n < events.length; n++) {
                let ev = events[n];
                let idx = n;
                let firstPhoto = ev.photos && ev.photos.length > 0 ? ev.photos[0].url : '';
                let eventCardElements = [
                    React.createElement('div', { className: 'card-titulo-evento', title: ev.name || 'Evento sin nombre', key: 'title' }, ev.name || 'Evento sin nombre')
                ];
                if (ev.fecha) {
                    eventCardElements.push(
                        React.createElement('div', { className: 'card-data-evento', key: 'date' },
                            React.createElement('span', { className: 'icon-eve-home', style: { fontSize: '16px', marginRight: '0.5rem' } }, 'üìÖ'),
                            ev.fecha
                        )
                    );
                }
                if (ev.ubicacion) {
                    eventCardElements.push(
                        React.createElement('div', { className: 'card-cid-evento', key: 'location' },
                            React.createElement('span', { className: 'icon-eve-home', style: { fontSize: '16px', marginRight: '0.5rem' } }, 'üìç'),
                            React.createElement('span', { className: 'nome-cidade-card' }, ev.ubicacion)
                        )
                    );
                }
                carouselItems.push(
                    React.createElement('div', { 
                        className: 'carousel-item', 
                        key: ev.name || `event-${n}`,
                        onClick: function (evParam) { return function () { handleSelectEvent(evParam); }; }(ev)
                    },
                        React.createElement('div', { className: 'foto' },
                            React.createElement('img', { 
                                src: firstPhoto, 
                                alt: `Portada ${ev.name || 'Evento'}`,
                                onError: function (e) { 
                                    e.target.src = 'https://via.placeholder.com/260x156?text=Imagen+no+disponible';
                                }
                            })
                        ),
                        React.createElement('div', { className: 'card-eventos' }, eventCardElements)
                    )
                );
            }

            let gallery = null;
            if (photos.length > 0) {
                gallery = React.createElement(Gallery, {
                    photos: photos,
                    isSelectionMode: isSelectionMode,
                    hasSelections: hasSelections,
                    selectedPhotos: selectedPhotos,
                    onToggleSelect: toggleSelect,
                    onOpenLightbox: openLightbox
                });
            } else {
                gallery = React.createElement('p', null, 'No hay fotos para mostrar.');
            }

            let lightbox = null;
            if (lightboxIndex !== -1 && photos.length > 0) {
                lightbox = React.createElement(Lightbox, {
                    photos: photos,
                    index: lightboxIndex,
                    onClose: closeLightbox,
                    onPrev: prevPhoto,
                    onNext: nextPhoto,
                    onToggleSelect: toggleSelect,
                    onGenerateOrder: handleGenerateFromLightbox,
                    selectedPhotos: selectedPhotos
                });
            }

            let reviewModal = null;
            if (showReview && selectedPhotos.length > 0) {
                reviewModal = React.createElement(ReviewModal, {
                    selectedPhotos: selectedPhotos,
                    reviewIndex: reviewIndex,
                    onClose: function () { setShowReview(false); },
                    onDeselect: removeSelect,
                    onPrev: prevReview,
                    onNext: nextReview,
                    onConfirm: handleConfirm
                });
            }

            let emailModal = null;
            if (showEmailModal) {
                emailModal = React.createElement(EmailModal, {
                    email: email,
                    setEmail: setEmail,
                    onClose: function () { setShowEmailModal(false); },
                    onSubmit: handleEmailSubmit,
                    selectedPhotos: selectedPhotos,
                    isSendingEmail: isSendingEmail
                });
            }

            let resultModal = null;
            if (showResultModal) {
                resultModal = React.createElement(ResultModal, {
                    resultMessage: resultMessage,
                    onClose: function () { setShowResultModal(false); }
                });
            }

            let selectionControls = null;
            if (isSelectionMode || hasSelections) {
                selectionControls = React.createElement('button', { onClick: toggleSelectionMode }, isSelectionMode ? 'Cancelar selecci√≥n' : 'Seleccionar im√°genes para orden');
                if (hasSelections) {
                    selectionControls = [
                        React.createElement('button', { key: 'toggle', onClick: toggleSelectionMode }, isSelectionMode ? 'Cancelar selecci√≥n' : 'Seleccionar im√°genes para orden'),
                        React.createElement('span', { key: 'count', className: 'selected-count' }, `${selectedPhotos.length} ${selectedPhotos.length === 1 ? 'imagen seleccionada' : 'im√°genes seleccionadas'}`),
                        React.createElement('button', { key: 'generate', onClick: function () { setShowReview(true); setReviewIndex(0); } }, 'Generar orden')
                    ];
                }
            } else {
                selectionControls = React.createElement('button', { onClick: toggleSelectionMode }, 'Seleccionar im√°genes para orden');
            }

            let headerTitle = selectedEvent ? selectedEvent.name || 'Evento sin nombre' : 'Galer√≠a de Eventos';

            let content = null;
            if (!selectedEvent) {
                content = [
                    React.createElement('header', { key: 'header' },
                        React.createElement('h1', null, headerTitle)
                    ),
                    React.createElement('h2', { key: 'h2', className: 'events-header' }, 'Eventos disponibles'),
                    React.createElement('div', { key: 'carousel', className: 'carousel' }, carouselItems)
                ];
            } else {
                content = [
                    React.createElement('header', { key: 'header' },
                        React.createElement('h1', null, headerTitle)
                    ),
                    React.createElement('div', { key: 'header-row', className: 'header-row' },
                        React.createElement('button', { key: 'back', className: 'back-button', onClick: function () { setSelectedEvent(null); } }, 'Volver a eventos'),
                        React.createElement('div', { key: 'controls', className: 'selection-controls-wrapper' }, selectionControls)
                    ),
                    gallery
                ];
            }

            return React.createElement('div', null, content, lightbox, reviewModal, emailModal, resultModal);
        }

        let root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
